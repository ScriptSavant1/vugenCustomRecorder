<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VuGen HAR Script Generator â€” LRE Admin Tool</title>
<style>
:root {
  --primary:#1e40af; --primary-lt:#3b82f6; --primary-bg:#eff6ff;
  --green:#16a34a; --red:#dc2626; --amber:#d97706;
  --bg:#f8fafc; --surface:#fff; --border:#e2e8f0;
  --text:#0f172a; --muted:#64748b; --code-bg:#1e1e1e;
}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Segoe UI',-apple-system,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow:hidden}

/* â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.hdr{background:var(--primary);color:#fff;padding:10px 18px;display:flex;align-items:center;gap:12px;box-shadow:0 2px 8px rgba(0,0,0,.25);z-index:100;position:relative}
.hdr h1{font-size:16px;font-weight:700;flex:1}
.hdr .ver{font-size:11px;opacity:.65}

/* â”€â”€ BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.btn{padding:5px 13px;border:none;border-radius:5px;font-size:12px;font-weight:600;cursor:pointer;display:inline-flex;align-items:center;gap:5px;transition:filter .12s;white-space:nowrap}
.btn:hover{filter:brightness(.88)}
.btn:active{filter:brightness(.75)}
.btn-primary{background:var(--primary-lt);color:#fff}
.btn-success{background:var(--green);color:#fff}
.btn-danger{background:var(--red);color:#fff}
.btn-ghost{background:rgba(255,255,255,.15);color:#fff;border:1px solid rgba(255,255,255,.3)}
.btn-muted{background:#f1f5f9;color:var(--text)}
.btn-sm{padding:4px 10px;font-size:11px}

/* â”€â”€ WELCOME PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#welcome{max-width:800px;margin:28px auto;padding:0 20px;overflow-y:auto;max-height:calc(100vh - 80px)}
.drop-zone{border:2px dashed var(--border);border-radius:12px;padding:36px 32px;background:var(--surface);cursor:pointer;transition:all .18s;text-align:center;margin-bottom:18px}
.drop-zone:hover,.drop-zone.over{border-color:var(--primary-lt);background:var(--primary-bg)}
.drop-zone .icon{font-size:40px;margin-bottom:8px}
.drop-zone h2{font-size:19px;margin-bottom:5px}
.drop-zone p{color:var(--muted);font-size:13px;margin-bottom:12px}

.instr{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:20px 24px;margin-bottom:16px}
.instr h3{font-size:14px;font-weight:700;color:var(--primary);margin-bottom:14px}
.steps{list-style:none;counter-reset:s}
.steps li{counter-increment:s;display:flex;gap:10px;margin-bottom:10px;font-size:12.5px;line-height:1.5;align-items:flex-start}
.steps li::before{content:counter(s);min-width:21px;height:21px;background:var(--primary);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;flex-shrink:0;margin-top:1px}
code{background:#f1f5f9;padding:2px 5px;border-radius:3px;font-family:Consolas,monospace;font-size:11.5px}
.tip{background:#fef9c3;border-left:3px solid #eab308;padding:8px 12px;border-radius:4px;font-size:12px;margin-top:12px;color:#713f12}
.warn{background:#fef2f2;border-left:3px solid var(--red);padding:8px 12px;border-radius:4px;font-size:12px;margin-top:10px;color:#7f1d1d}

/* bookmarklet drag links */
.bm-box{background:#f0fdf4;border:1px solid #86efac;border-radius:10px;padding:18px 22px;margin-bottom:16px}
.bm-box h3{font-size:14px;font-weight:700;color:#166534;margin-bottom:6px}
.bm-box p{font-size:12.5px;color:#166534;margin-bottom:14px}
.bm-links{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px}
.bm-drag{display:inline-flex;align-items:center;gap:7px;padding:9px 18px;border-radius:8px;font-size:13px;font-weight:700;text-decoration:none;cursor:grab;user-select:none;border:2px solid;transition:filter .12s}
.bm-drag:hover{filter:brightness(.93)}
.bm-start{background:#dcfce7;color:#166534;border-color:#22c55e}
.bm-end{background:#fee2e2;color:#991b1b;border-color:#ef4444}
.bm-note{font-size:11.5px;color:#374151;background:#f9fafb;border:1px solid var(--border);border-radius:6px;padding:8px 12px}
.bm-note strong{display:block;margin-bottom:4px}

/* â”€â”€ DOMAIN FILTER PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.domain-pane{width:195px;flex-shrink:0;border-right:1px solid var(--border);display:flex;flex-direction:column;background:var(--surface);overflow:hidden}
.dp-hdr{padding:7px 10px;border-bottom:1px solid var(--border);background:#f8fafc;flex-shrink:0}
.dp-hdr-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:5px}
.dp-hdr-title{font-size:11.5px;font-weight:700;color:var(--text)}
.dp-acts{display:flex;gap:4px}
.dp-acts button{font-size:10px;padding:2px 7px;border:1px solid var(--border);border-radius:3px;background:#fff;cursor:pointer;color:var(--muted);transition:all .1s}
.dp-acts button:hover{background:var(--primary-bg);border-color:var(--primary-lt);color:var(--primary)}
.dp-search{width:100%;padding:3px 7px;border:1px solid var(--border);border-radius:4px;font-size:11px;outline:none;box-sizing:border-box}
.dp-search:focus{border-color:var(--primary-lt)}
.dp-list{overflow-y:auto;flex:1}
.dp-row{display:flex;align-items:flex-start;gap:6px;padding:5px 8px;border-bottom:1px solid #f1f5f9;cursor:pointer;transition:background .1s;user-select:none}
.dp-row:hover{background:#f8fafc}
.dp-row input[type=checkbox]{flex-shrink:0;margin-top:2px;cursor:pointer;accent-color:var(--primary)}
.dp-domain{font-size:10.5px;font-family:Consolas,monospace;color:var(--text);word-break:break-all;flex:1;line-height:1.4}
.dp-row.dm-off .dp-domain{color:var(--muted)}
.dp-meta{font-size:9.5px;color:var(--muted);text-align:right;flex-shrink:0;line-height:1.5}
.dp-empty{padding:14px 10px;font-size:11px;color:var(--muted);text-align:center}

/* â”€â”€ RESIZABLE PANEL DIVIDERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.resizer{width:5px;flex-shrink:0;cursor:col-resize;background:var(--border);position:relative;transition:background .15s;z-index:10}
.resizer:hover,.resizer.rs-active{background:var(--primary-lt)}
.resizer::after{content:'';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:1px;height:30px;background:currentColor;opacity:0;transition:opacity .15s}
.resizer:hover::after,.resizer.rs-active::after{opacity:.5}

/* â”€â”€ FORMAT PICKER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.fmt-cards{display:flex;gap:12px;margin:16px 0 6px}
.fmt-card{flex:1;border:2px solid var(--border);border-radius:10px;padding:16px 12px;cursor:pointer;text-align:center;transition:all .15s;user-select:none}
.fmt-card:hover{border-color:var(--primary-lt);background:var(--primary-bg)}
.fmt-card.selected{border-color:var(--primary);background:var(--primary-bg);box-shadow:0 0 0 3px rgba(59,130,246,.15)}
.fmt-card-icon{font-size:28px;margin-bottom:8px}
.fmt-card-title{font-size:14px;font-weight:700;margin-bottom:4px;color:var(--text)}
.fmt-card-sub{font-size:11px;color:var(--muted);margin-bottom:8px}
.fmt-card-files{font-size:10.5px;color:var(--muted);line-height:1.7;background:#f8fafc;border-radius:5px;padding:5px 8px}
.fmt-badge{display:inline-flex;align-items:center;gap:5px;font-size:11px;font-weight:700;color:var(--primary);background:var(--primary-bg);border:1px solid #bfdbfe;border-radius:4px;padding:2px 8px}

/* â”€â”€ MAIN PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#main{display:flex;flex-direction:column;height:calc(100vh - 44px)}

/* toolbar */
.tbar{background:var(--surface);border-bottom:1px solid var(--border);padding:7px 14px;display:flex;align-items:center;gap:10px;flex-wrap:wrap;flex-shrink:0}
.tbar-sep{width:1px;height:22px;background:var(--border)}
.chk-lbl{display:flex;align-items:center;gap:5px;font-size:12px;cursor:pointer;user-select:none}
.chk-lbl input{cursor:pointer}
#sel-bar{display:none;align-items:center;gap:8px;font-size:12px}
#stats{margin-left:auto;font-size:11px;color:var(--muted)}

/* content split */
.split{display:flex;flex:1;overflow:hidden}

/* request table pane */
.req-pane{flex:1;overflow:auto;border-right:1px solid var(--border);min-width:180px}
table{width:100%;border-collapse:collapse;font-size:11.5px}
thead th{position:sticky;top:0;background:#f8fafc;border-bottom:1px solid var(--border);padding:7px 9px;text-align:left;font-weight:700;color:var(--muted);white-space:nowrap;z-index:5}
tbody tr:hover{background:#f8fafc}
tbody td{padding:5px 9px;border-bottom:1px solid #f1f5f9;vertical-align:middle;max-width:0}

/* method badges */
.m{display:inline-block;padding:2px 6px;border-radius:3px;font-weight:700;font-size:10px;min-width:44px;text-align:center}
.m-GET{background:#dcfce7;color:#166534}.m-POST{background:#dbeafe;color:#1e40af}
.m-PUT{background:#ffedd5;color:#9a3412}.m-DELETE{background:#fee2e2;color:#991b1b}
.m-PATCH{background:#f3e8ff;color:#6b21a8}.m-X{background:#f1f5f9;color:var(--muted)}

/* status badges */
.s{display:inline-block;padding:2px 6px;border-radius:3px;font-weight:700;font-size:11px}
.s2{background:#dcfce7;color:#166534}.s3{background:#dbeafe;color:#1e40af}
.s4{background:#ffedd5;color:#9a3412}.s5{background:#fee2e2;color:#991b1b}
.s0{background:#f1f5f9;color:var(--muted)}

.url-cell{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.row-dim{opacity:.3}

/* transaction marker rows */
.txn-start td,.txn-end td{padding:4px 10px;font-weight:700;font-size:11px;letter-spacing:.3px}
.txn-start td{border-top:2px solid}
.txn-end td{border-bottom:2px solid}

/* selectable rows */
tr.selectable{cursor:pointer}
tr.row-sel{outline:2px solid var(--primary-lt);outline-offset:-2px;background:var(--primary-bg) !important}

/* â”€â”€ SCRIPT PANE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.code-pane{width:44%;min-width:320px;display:flex;flex-direction:column;background:var(--code-bg);flex-shrink:0}
.code-tabs{display:flex;background:#252526;border-bottom:1px solid #333;overflow-x:auto;flex-shrink:0}
.code-tab{padding:7px 13px;font-size:11.5px;color:#9ca3af;cursor:pointer;border-bottom:2px solid transparent;white-space:nowrap;user-select:none;flex-shrink:0}
.code-tab.act{color:#fff;border-bottom-color:var(--primary-lt);background:var(--code-bg)}
.code-tab:hover:not(.act){color:#d1d5db}
.code-body{flex:1;overflow:auto;padding:14px 16px;font-family:Consolas,Monaco,monospace;font-size:12px;color:#d4d4d4;line-height:1.65;white-space:pre}

/* â”€â”€ DOWNLOAD BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.dl-bar{background:var(--surface);border-top:1px solid var(--border);padding:8px 14px;display:flex;align-items:center;gap:8px;flex-wrap:wrap;flex-shrink:0}
.dl-bar label{font-size:11px;color:var(--muted);font-weight:700}

/* â”€â”€ MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:200}
.modal{background:#fff;border-radius:10px;padding:22px 26px;min-width:340px;box-shadow:0 24px 60px rgba(0,0,0,.3)}
.modal h3{font-size:15px;margin-bottom:14px;font-weight:700}
.fg{margin-bottom:12px}
.fg label{display:block;font-size:11.5px;font-weight:700;margin-bottom:4px}
.fg input{width:100%;padding:7px 10px;border:1px solid var(--border);border-radius:5px;font-size:13px}
.fg input:focus{outline:none;border-color:var(--primary-lt)}
.modal-actions{display:flex;justify-content:flex-end;gap:8px;margin-top:14px}

.hidden{display:none!important}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HEADER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<header class="hdr">
  <h1>âš¡ VuGen HAR Script Generator</h1>
  <span class="ver">v1.0 | LRE Admin Tool</span>
  <button class="btn btn-ghost btn-sm" onclick="showWelcome()">ğŸ“‚ Load HAR</button>
  <button class="btn btn-ghost btn-sm" onclick="clearAll()">ğŸ—‘ Clear</button>
</header>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• WELCOME â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="welcome">
  <div class="drop-zone" id="dz"
       onclick="document.getElementById('hf').click()"
       ondrop="onDrop(event)" ondragover="onDragOver(event)" ondragleave="onDragLeave(event)">
    <div class="icon">ğŸ“</div>
    <h2>Drop your .har file here</h2>
    <p>or click to browse</p>
    <button class="btn btn-primary" onclick="event.stopPropagation();document.getElementById('hf').click()">Browse HAR File</button>
  </div>
  <input type="file" id="hf" accept=".har" hidden onchange="onFilePick(event)">

  <!-- BOOKMARKLET SETUP -->
  <div class="bm-box">
    <h3>ğŸ”– Step 1 â€” Set Up Transaction Bookmarklets <span style="font-weight:400;font-size:12px">(one-time setup)</span></h3>
    <p>Drag these two buttons onto your browser's Bookmarks Bar. Once there, click them during recording to mark the start and end of each transaction â€” no need to type URLs or leave your application.</p>
    <div class="bm-links">
      <a class="bm-drag bm-start"
         href="javascript:(function(){var n=prompt('Transaction name (e.g. T01_Login):','T01_Name');if(n){n=n.trim().replace(/[\s-]+/g,'_');if(n)fetch('https://START-'+n+'.invalid',{mode:'no-cors'}).catch(function(){})}})();"
         onclick="alert('Drag this button to your Bookmarks Bar â€” do not click it here.');return false;">â–¶ START Transaction</a>
      <a class="bm-drag bm-end"
         href="javascript:(function(){var n=prompt('Transaction name (e.g. T01_Login):','T01_Name');if(n){n=n.trim().replace(/[\s-]+/g,'_');if(n)fetch('https://END-'+n+'.invalid',{mode:'no-cors'}).catch(function(){})}})();"
         onclick="alert('Drag this button to your Bookmarks Bar â€” do not click it here.');return false;">â–  END Transaction</a>
    </div>
    <div class="bm-note">
      <strong>How to add to Bookmarks Bar:</strong>
      Show your Bookmarks Bar first: <strong>Ctrl+Shift+B</strong> (Chrome/Edge) or <strong>Ctrl+Shift+B</strong> (Firefox).
      Then drag each coloured button above and drop it onto the bookmarks bar. The buttons will stay there permanently.
    </div>
  </div>

  <!-- RECORDING STEPS -->
  <div class="instr">
    <h3>ğŸ“‹ Step 2 â€” Record Your Application</h3>
    <ol class="steps">
      <li>Open your browser â†’ press <strong>F12</strong> â†’ click the <strong>Network</strong> tab â†’ click ğŸš« to clear existing entries</li>
      <li>Click the <strong style="color:#166534">â–¶ START Transaction</strong> bookmark â†’ type a name (e.g. <code>T01_Login</code>) â†’ click OK</li>
      <li>Browse your application normally â€” navigate by clicking buttons and links as you normally would</li>
      <li>When done with that transaction, click the <strong style="color:#991b1b">â–  END Transaction</strong> bookmark â†’ type the <em>same</em> name â†’ click OK</li>
      <li>Immediately click <strong style="color:#166534">â–¶ START Transaction</strong> again for the next transaction â€” keep browsing without stopping</li>
      <li>After all transactions are done: in the Network tab, <strong>right-click any row â†’ "Save all as HAR with content"</strong></li>
      <li>Drop the saved <code>.har</code> file in the area above â€” both scripts are generated automatically</li>
    </ol>
    <div class="tip">ğŸ’¡ <strong>No bookmarklets / forgot markers?</strong> Use <strong>Select Mode</strong> after loading the HAR to manually group requests into transactions.</div>
    <div class="warn">âš ï¸ Keep the Developer Tools (F12) open for the entire recording session. Closing it loses all recorded data.</div>
  </div>

  <!-- FALLBACK METHOD -->
  <details style="margin-bottom:16px">
    <summary style="cursor:pointer;font-size:12.5px;color:var(--muted);padding:8px 12px;background:var(--surface);border:1px solid var(--border);border-radius:6px;user-select:none">
      ğŸ”— Alternative: Address Bar Method (if bookmarklets are blocked by your organisation)
    </summary>
    <div class="instr" style="border-top:0;border-radius:0 0 10px 10px;margin-top:0">
      <ol class="steps" style="margin-top:10px">
        <li>In the browser address bar, type <code>https://START-T01-Login.invalid</code> and press Enter (error page is expected)</li>
        <li>Type your application URL to go back, then perform all steps for this transaction</li>
        <li>Type <code>https://END-T01-Login.invalid</code> in the address bar and press Enter</li>
        <li>Do <strong>not</strong> click the Back button â€” type the next START URL directly in the address bar</li>
        <li>Repeat for each transaction (T02, T03 etc.)</li>
      </ol>
    </div>
  </details>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MAIN PANEL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="main" class="hidden">

  <!-- TOOLBAR -->
  <div class="tbar">
    <span style="font-size:12px;font-weight:700">Filters:</span>
    <label class="chk-lbl"><input type="checkbox" id="f-static" checked onchange="refresh()"> Static Assets</label>
    <label class="chk-lbl"><input type="checkbox" id="f-noise"  checked onchange="refresh()"> Analytics/Ads</label>
    <label class="chk-lbl"><input type="checkbox" id="f-opts"   checked onchange="refresh()"> OPTIONS</label>
    <div class="tbar-sep"></div>
    <button class="btn btn-muted btn-sm" id="btn-sel" onclick="toggleSelMode()">â˜‘ Select Mode</button>
    <div id="sel-bar">
      <span id="sel-cnt">0 selected</span>
      <button class="btn btn-primary btn-sm" onclick="openTxnModal()">+ Create Transaction</button>
      <button class="btn btn-muted btn-sm" onclick="clearSel()">âœ• Cancel</button>
    </div>
    <div class="tbar-sep"></div>
    <span class="fmt-badge" id="fmt-badge">ğŸŒ Web HTTP/HTML</span>
    <button class="btn btn-muted btn-sm" onclick="openFmtModal(true)">âš™ Change Format</button>
    <span id="stats"></span>
  </div>

  <!-- SPLIT VIEW -->
  <div class="split">

    <!-- DOMAIN FILTER PANEL -->
    <div class="domain-pane" id="domain-pane">
      <div class="dp-hdr">
        <div class="dp-hdr-top">
          <span class="dp-hdr-title">ğŸŒ <span id="dp-title">Domains</span></span>
          <div class="dp-acts">
            <button onclick="toggleAllDomains(true)">All</button>
            <button onclick="toggleAllDomains(false)">None</button>
          </div>
        </div>
        <input class="dp-search" type="text" placeholder="Search domainsâ€¦" oninput="renderDomainPanel(this.value)">
      </div>
      <div class="dp-list" id="dp-list">
        <div class="dp-empty">Load a HAR file</div>
      </div>
    </div>

    <!-- RESIZER: domain | table -->
    <div class="resizer" id="rs-left"></div>

    <!-- REQUEST TABLE -->
    <div class="req-pane" id="req-pane">
      <table>
        <thead>
          <tr>
            <th style="width:38px">#</th>
            <th style="width:66px">Method</th>
            <th>URL</th>
            <th style="width:58px">Status</th>
            <th style="width:88px">Type</th>
            <th style="width:62px">Size</th>
            <th style="width:58px">Time</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <!-- RESIZER: table | code -->
    <div class="resizer" id="rs-right"></div>

    <!-- SCRIPT PREVIEW -->
    <div class="code-pane" id="code-pane">
      <div class="code-tabs">
        <div class="code-tab act" data-tab="ac" onclick="switchTab(this,'ac')">Action.c</div>
        <div class="code-tab" data-tab="mj" onclick="switchTab(this,'mj')">main.js (DevWeb)</div>
        <div class="code-tab" data-tab="vi" onclick="switchTab(this,'vi')">vuser_init.c</div>
        <div class="code-tab" data-tab="ve" onclick="switchTab(this,'ve')">vuser_end.c</div>
        <div class="code-tab" data-tab="gh" onclick="switchTab(this,'gh')">globals.h</div>
      </div>
      <pre class="code-body" id="code-body">// Load a HAR file to see generated scripts</pre>
    </div>

  </div><!-- /split -->

  <!-- DOWNLOAD BAR -->
  <div class="dl-bar">
    <span id="dl-webhttp" style="display:inline-flex;align-items:center;gap:8px">
      <label>Web HTTP/HTML:</label>
      <button class="btn btn-success btn-sm" onclick="dl('ac')">â¬‡ Action.c</button>
      <button class="btn btn-muted btn-sm" onclick="dl('vi')">â¬‡ vuser_init.c</button>
      <button class="btn btn-muted btn-sm" onclick="dl('ve')">â¬‡ vuser_end.c</button>
      <button class="btn btn-muted btn-sm" onclick="dl('gh')">â¬‡ globals.h</button>
    </span>
    <div class="tbar-sep" id="dl-sep"></div>
    <span id="dl-devweb" style="display:inline-flex;align-items:center;gap:8px">
      <label>DevWeb:</label>
      <button class="btn btn-primary btn-sm" onclick="dl('mj')">â¬‡ main.js</button>
    </span>
    <div class="tbar-sep"></div>
    <button class="btn btn-success btn-sm" onclick="dlAll()">â¬‡ Download All Files</button>
  </div>

</div><!-- /main -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• FORMAT PICKER MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="fmt-modal-bg" class="modal-bg hidden">
  <div class="modal" style="min-width:560px;max-width:600px">
    <h3>Choose Script Format</h3>
    <p style="font-size:12.5px;color:var(--muted);margin-top:-8px">Select the protocol your LRE project uses. You can change this later.</p>
    <div class="fmt-cards">

      <div class="fmt-card selected" id="fc-webhttp" onclick="selectFmt('webhttp')">
        <div class="fmt-card-icon">ğŸŒ</div>
        <div class="fmt-card-title">Web HTTP/HTML</div>
        <div class="fmt-card-sub">C Language Protocol</div>
        <div class="fmt-card-files">Action.c<br>vuser_init.c<br>vuser_end.c<br>globals.h</div>
      </div>

      <div class="fmt-card" id="fc-devweb" onclick="selectFmt('devweb')">
        <div class="fmt-card-icon">âš¡</div>
        <div class="fmt-card-title">DevWeb</div>
        <div class="fmt-card-sub">JavaScript Protocol</div>
        <div class="fmt-card-files">main.js</div>
      </div>

      <div class="fmt-card" id="fc-both" onclick="selectFmt('both')">
        <div class="fmt-card-icon">ğŸ“¦</div>
        <div class="fmt-card-title">Both Formats</div>
        <div class="fmt-card-sub">All files generated</div>
        <div class="fmt-card-files">Action.c Â· main.js<br>vuser_init.c<br>vuser_end.c Â· globals.h</div>
      </div>

    </div>
    <div class="modal-actions">
      <button class="btn btn-muted btn-sm" id="fmt-cancel-btn" onclick="closeFmtModal()">Cancel</button>
      <button class="btn btn-primary btn-sm" onclick="confirmFmt()">Continue â†’</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="modal-bg" class="modal-bg hidden">
  <div class="modal">
    <h3>Create Transaction</h3>
    <div class="fg">
      <label>Transaction Name</label>
      <input id="txn-inp" type="text" placeholder="e.g. T01_Login"
             onkeydown="if(event.key==='Enter')confirmTxn()">
    </div>
    <p style="font-size:11px;color:var(--muted);margin-top:-6px">Use format: T01_Login, T02_Search, T03_Checkout</p>
    <div class="modal-actions">
      <button class="btn btn-muted btn-sm" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary btn-sm" onclick="confirmTxn()">Create</button>
    </div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const S = {
  entries: [],        // all parsed HAR entries
  txns: [],           // [{name, color}]
  colorMap: {},       // txnName â†’ color object
  selMode: false,
  selIds: new Set(),
  tab: 'ac',
  scripts: {},
  format: 'webhttp',  // 'webhttp' | 'devweb' | 'both'
  pendingHar: null,   // parsed HAR JSON waiting for format confirmation
  domainFilter: {},   // hostname â†’ true (include) | false (exclude)
  domainStats: {}     // hostname â†’ {count, size}
};

const COLORS = [
  {bg:'#dbeafe',bd:'#3b82f6',tx:'#1e40af'},
  {bg:'#dcfce7',bd:'#22c55e',tx:'#166534'},
  {bg:'#fef9c3',bd:'#eab308',tx:'#854d0e'},
  {bg:'#fce7f3',bd:'#ec4899',tx:'#9d174d'},
  {bg:'#ede9fe',bd:'#8b5cf6',tx:'#5b21b6'},
  {bg:'#ffedd5',bd:'#f97316',tx:'#9a3412'},
  {bg:'#ccfbf1',bd:'#14b8a6',tx:'#134e4a'},
  {bg:'#e0f2fe',bd:'#0ea5e9',tx:'#075985'},
];

const FILE_NAMES = {ac:'Action.c',mj:'main.js',vi:'vuser_init.c',ve:'vuser_end.c',gh:'globals.h'};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FILE LOADING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function onFilePick(e){ const f=e.target.files[0]; if(f) readHAR(f); }
function onDrop(e){
  e.preventDefault();
  document.getElementById('dz').classList.remove('over');
  const f=e.dataTransfer.files[0];
  if(f&&f.name.toLowerCase().endsWith('.har')) readHAR(f);
  else alert('Please drop a .har file');
}
function onDragOver(e){ e.preventDefault(); document.getElementById('dz').classList.add('over'); }
function onDragLeave(){ document.getElementById('dz').classList.remove('over'); }

function readHAR(file){
  const r=new FileReader();
  r.onload=e=>{
    try{
      S.domainFilter={}; // reset domain filter for new HAR
      S.pendingHar=JSON.parse(e.target.result);
      openFmtModal(false);
    }catch(err){ alert('Could not parse HAR file:\n'+err.message); }
  };
  r.readAsText(file);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HAR PROCESSING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function processHAR(har){
  S.entries=[]; S.txns=[]; S.colorMap={}; S.selIds.clear(); S.selMode=false;

  const raw = har.log && har.log.entries ? har.log.entries : [];
  let id=0;

  S.entries = raw.map(e=>{
    const hdrs={};
    (e.request.headers||[]).forEach(h=>{ hdrs[h.name.toLowerCase()]=h.value; });
    const ct=((e.response.content&&e.response.content.mimeType)||'').split(';')[0].trim();
    return {
      id: ++id,
      url:   e.request.url||'',
      method: (e.request.method||'GET').toUpperCase(),
      status: e.response.status||0,
      ct,
      size: e.response.bodySize>0 ? e.response.bodySize : (e.response.content&&e.response.content.size>0?e.response.content.size:0),
      dur:  Math.round(e.time||0),
      reqHdrs: e.request.headers||[],
      hdrsMap: hdrs,
      body: e.request.postData||null,
      referer: hdrs['referer']||'',
      isMarker:false, markerType:null, txnName:null,
      txn:null, filtered:false
    };
  });

  detectMarkers();
  buildDomainStats();
  renderDomainPanel();
  applyFilters();
  buildScripts();
  renderTable();
  renderStats();
  showScript();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TRANSACTION MARKER DETECTION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function detectMarkers(){
  S.txns=[]; S.colorMap={};
  let cIdx=0;

  for(const e of S.entries){
    const url=e.url;
    // Match: https://START-TxnName.invalid  or  https://TxnName-START.invalid
    const sm = url.match(/\/\/START[-_]([^/.\s?]+)\.invalid/i)
            || url.match(/\/\/([^/.\s?]+)[-_]START\.invalid/i);
    const em = url.match(/\/\/END[-_]([^/.\s?]+)\.invalid/i)
            || url.match(/\/\/([^/.\s?]+)[-_]END\.invalid/i);

    if(sm){
      const name = sm[1].replace(/[-]/g,'_');
      e.isMarker=true; e.markerType='start'; e.txnName=name;
      if(!S.colorMap[name]){
        const c=COLORS[cIdx%COLORS.length]; cIdx++;
        S.colorMap[name]=c;
        S.txns.push({name,color:c});
      }
    } else if(em){
      const name = em[1].replace(/[-]/g,'_');
      e.isMarker=true; e.markerType='end'; e.txnName=name;
    }
  }

  // Assign txn membership to entries between markers
  let active=null;
  for(const e of S.entries){
    if(e.isMarker){ active = e.markerType==='start' ? e.txnName : null; }
    else { e.txn=active; }
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FILTERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const STATIC_CT=new Set([
  'image/png','image/jpeg','image/jpg','image/gif','image/svg+xml','image/webp',
  'image/x-icon','image/vnd.microsoft.icon','image/bmp',
  'font/woff','font/woff2','font/ttf','font/eot','font/otf',
  'application/font-woff','application/font-woff2','application/x-font-woff',
  'text/css','application/javascript','text/javascript','application/x-javascript'
]);
const STATIC_EXT=/\.(png|jpe?g|gif|ico|svg|webp|woff2?|ttf|eot|otf|css|js\.map|map)(\?|$)/i;
const NOISY=/google-analytics|googletagmanager|doubleclick|googlesyndication|facebook\.net|hotjar|segment\.io|mixpanel|amplitude|clarity\.ms|adnxs|scorecardresearch|outbrain|taboola|adsrvr|pubmatic/i;

function applyFilters(){
  const fSt=document.getElementById('f-static')?.checked??true;
  const fNo=document.getElementById('f-noise')?.checked??true;
  const fOp=document.getElementById('f-opts')?.checked??true;

  for(const e of S.entries){
    if(e.isMarker){e.filtered=false;continue;}
    // Domain filter (unchecked domains are excluded)
    try{
      const host=new URL(e.url).hostname;
      if(S.domainFilter[host]===false){e.filtered=true;continue;}
    }catch{}
    if(fOp && e.method==='OPTIONS'){e.filtered=true;continue;}
    if(fSt){
      if(STATIC_CT.has(e.ct)){e.filtered=true;continue;}
      if(STATIC_EXT.test(e.url.split('?')[0])){e.filtered=true;continue;}
    }
    if(fNo){
      try{ if(NOISY.test(new URL(e.url).hostname)){e.filtered=true;continue;} }catch{}
    }
    e.filtered=false;
  }
}

function refresh(){
  applyFilters(); buildScripts(); renderTable(); renderStats(); showScript();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER TABLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderTable(){
  let html='';
  for(const e of S.entries){
    if(e.isMarker){ html+=markerRow(e); continue; }
    html+=entryRow(e);
  }
  document.getElementById('tbody').innerHTML = html||'<tr><td colspan="7" style="text-align:center;padding:40px;color:var(--muted)">No entries</td></tr>';
}

function markerRow(e){
  const c=S.colorMap[e.txnName]||COLORS[0];
  const icon=e.markerType==='start'?'â–¶ START':'â–  END';
  const border=e.markerType==='start'?'border-top':'border-bottom';
  return `<tr class="txn-${e.markerType}" style="background:${c.bg};${border}:2px solid ${c.bd}">
    <td colspan="7" style="color:${c.tx};font-weight:700;font-size:11px;letter-spacing:.4px">
      ${icon}: ${e.txnName}
    </td></tr>`;
}

function entryRow(e){
  const mc='m-'+(['GET','POST','PUT','DELETE','PATCH'].includes(e.method)?e.method:'X');
  let sc='s0';
  if(e.status>=200&&e.status<300)sc='s2';
  else if(e.status>=300&&e.status<400)sc='s3';
  else if(e.status>=400&&e.status<500)sc='s4';
  else if(e.status>=500)sc='s5';

  const shortCt=e.ct.replace(/application\//,'').replace(/text\//,'')
    .replace('json','JSON').replace('html','HTML').replace('xml','XML')
    .replace('javascript','JS').replace('x-www-form-urlencoded','Form').substring(0,14);

  const c=e.txn&&S.colorMap[e.txn]?S.colorMap[e.txn]:null;
  const rowBg=c&&!e.filtered?`background:${c.bg}30`:'';
  const dim=e.filtered?'row-dim':'';
  const sel=S.selIds.has(e.id)?'row-sel':'';
  const selable=S.selMode&&!e.filtered?'selectable':'';

  const urlShort=e.url.length>75?e.url.substring(0,75)+'â€¦':e.url;

  return `<tr id="r${e.id}" class="${dim} ${sel} ${selable}"
    style="${rowBg}" onclick="rowClick(${e.id})" title="${esc(e.url)}">
    <td style="color:var(--muted)">${e.id}</td>
    <td><span class="m ${mc}">${e.method}</span></td>
    <td class="url-cell">${esc(urlShort)}</td>
    <td><span class="s ${sc}">${e.status||'-'}</span></td>
    <td style="color:var(--muted);font-size:11px">${esc(shortCt)}</td>
    <td style="color:var(--muted)">${fmtSize(e.size)}</td>
    <td style="color:var(--muted)">${e.dur>0?e.dur+'ms':'-'}</td>
  </tr>`;
}

function renderStats(){
  const total=S.entries.filter(e=>!e.isMarker).length;
  const shown=S.entries.filter(e=>!e.isMarker&&!e.filtered).length;
  const tc=S.txns.length;
  document.getElementById('stats').textContent=
    `${shown}/${total} requests  |  ${tc} transaction${tc!==1?'s':''}`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCRIPT GENERATION â€” Web HTTP/HTML (Action.c)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function genActionC(){
  const nc={};
  function name(url){
    let n='request';
    try{
      const p=new URL(url);
      const segs=p.pathname.split('/').filter(Boolean);
      let r=segs[segs.length-1]||p.hostname.split('.')[0]||'req';
      r=r.replace(/\.[^.]+$/,'').replace(/[^a-zA-Z0-9]/g,'_')
         .replace(/^_+|_+$/g,'').replace(/_+/g,'_').substring(0,24)||'request';
      if(/^\d/.test(r)) r='req_'+r;
      n=r;
    }catch{}
    if(nc[n]){nc[n]++;return n+'_'+nc[n];}
    nc[n]=1; return n;
  }

  let o='Action()\n{\n\n\tweb_set_sockets_option("SSL_VERSION", "AUTO");\n\n';
  let snap=1;

  for(const e of S.entries){
    if(e.isMarker){
      if(e.markerType==='start')
        o+=`\tlr_start_transaction("${e.txnName}");\n\n`;
      else{
        o+=`\tlr_end_transaction("${e.txnName}", LR_AUTO);\n\n`;
        o+=`\tlr_think_time(3);\n\n`;
      }
      continue;
    }
    if(e.filtered) continue;

    const n=name(e.url);
    const ct=e.ct||'text/html';
    const ref=e.referer||'';
    const sn=`t${snap++}.inf`;

    if(e.method==='GET'||e.method==='HEAD'){
      o+=`\tweb_url("${n}",\n\t\t"URL=${e.url}",\n\t\t"Resource=0",\n`;
      o+=`\t\t"RecContentType=${ct}",\n\t\t"Referer=${ref}",\n`;
      o+=`\t\t"Snapshot=${sn}",\n\t\t"Mode=HTML",\n\t\tLAST);\n\n`;
    } else {
      let encType='application/x-www-form-urlencoded';
      let body='';
      if(e.body){
        encType=(e.body.mimeType||encType).split(';')[0].trim();
        body=(e.body.text||'').replace(/\\/g,'\\\\').replace(/"/g,'\\"')
             .replace(/\r?\n/g,'\\n').replace(/\t/g,'\\t');
      }
      o+=`\tweb_custom_request("${n}",\n\t\t"URL=${e.url}",\n\t\t"Method=${e.method}",\n`;
      o+=`\t\t"Resource=0",\n\t\t"RecContentType=${ct}",\n`;
      o+=`\t\t"Referer=${ref}",\n\t\t"Snapshot=${sn}",\n\t\t"Mode=HTML",\n`;
      o+=`\t\t"EncType=${encType}",\n`;
      if(body){
        // Split long bodies into multi-line C string concatenation (max 200 chars/line)
        const CHUNK=200;
        if(body.length<=CHUNK){
          o+=`\t\t"Body=${body}",\n`;
        } else {
          const first=body.substring(0,CHUNK);
          o+=`\t\t"Body=${first}"\n`;
          let i=CHUNK;
          while(i<body.length){
            const chunk=body.substring(i,i+CHUNK);
            i+=CHUNK;
            if(i<body.length) o+=`\t\t"${chunk}"\n`;
            else o+=`\t\t"${chunk}",\n`;
          }
        }
      }
      o+=`\t\tLAST);\n\n`;
    }
  }
  o+='\treturn 0;\n}\n';
  return o;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCRIPT GENERATION â€” DevWeb (main.js)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SKIP_HDRS=new Set([
  'host','content-length','connection','accept-encoding','user-agent',
  'cache-control','pragma','sec-ch-ua','sec-ch-ua-mobile','sec-ch-ua-platform',
  'sec-fetch-dest','sec-fetch-mode','sec-fetch-site','sec-fetch-user',
  'upgrade-insecure-requests','dnt','origin','if-none-match','if-modified-since',
  'if-unmodified-since','te','trailer','transfer-encoding','via','x-forwarded-for'
]);

function genMainJS(){
  let o='';
  let rid=1;
  const nc={};
  function name(url){
    let n='request';
    try{
      const p=new URL(url);
      const segs=p.pathname.split('/').filter(Boolean);
      let r=segs[segs.length-1]||p.hostname.split('.')[0]||'req';
      r=r.replace(/\.[^.]+$/,'').replace(/[^a-zA-Z0-9]/g,'_')
         .replace(/^_+|_+$/g,'').replace(/_+/g,'_').substring(0,24)||'request';
      if(/^\d/.test(r)) r='req_'+r;
      n=r;
    }catch{}
    if(nc[n]){nc[n]++;return n+'_'+nc[n];}
    nc[n]=1; return n;
  }

  function hdrs(e){
    const h={};
    for(const hdr of (e.reqHdrs||[])){
      const k=hdr.name.toLowerCase();
      if(!SKIP_HDRS.has(k)&&!k.startsWith(':')) h[hdr.name]=hdr.value;
    }
    return h;
  }

  function reqBlock(e){
    const headers=hdrs(e);
    let c=`    new load.WebRequest({\n`;
    c+=`        id: ${rid++},\n`;
    c+=`        url: "${escJs(e.url)}",\n`;
    if(e.method!=='GET') c+=`        method: "${e.method}",\n`;
    if(Object.keys(headers).length>0){
      c+=`        headers: {\n`;
      for(const [k,v] of Object.entries(headers))
        c+=`            "${escJs(k)}": "${escJs(v)}",\n`;
      c+=`        },\n`;
    }
    if(e.body&&e.body.text){
      c+=`        body: \`${escTpl(e.body.text)}\`,\n`;
    }
    c+=`        returnBody: false,\n`;
    c+=`    }).sendSync();\n\n`;
    return c;
  }

  // Initialize
  o+='load.initialize("Initialize", async function() {\n';
  o+='    // Add initialization code here (login, token acquisition, etc.)\n';
  o+='});\n\n';

  // Process entries in order, grouping by transactions
  let inTxn=false, txnBuf='', preBuf='', preWritten=false;

  for(const e of S.entries){
    if(e.isMarker){
      if(e.markerType==='start'){
        // Flush pre-action entries
        if(preBuf&&!preWritten){
          o+='load.action("PreActions", async function() {\n'+preBuf+'});\n\n';
          preWritten=true; preBuf='';
        }
        inTxn=true;
        txnBuf=`load.action("${e.txnName}", async function() {\n`;
        txnBuf+=`    let txn = new load.Transaction("${e.txnName}");\n`;
        txnBuf+=`    txn.start();\n\n`;
      } else {
        txnBuf+=`    txn.stop();\n`;
        txnBuf+=`    load.sleep(3);\n`;
        txnBuf+=`});\n\n`;
        o+=txnBuf; txnBuf=''; inTxn=false;
      }
      continue;
    }
    if(e.filtered) continue;
    if(inTxn) txnBuf+=reqBlock(e);
    else preBuf+=reqBlock(e);
  }

  // Remaining pre-entries (no transactions at all)
  if(preBuf&&!preWritten){
    o+='load.action("Actions", async function() {\n'+preBuf+'});\n\n';
  }

  // Finalize
  o+='load.finalize("Finalize", async function() {\n';
  o+='    // Add cleanup code here (logout, etc.)\n';
  o+='});\n';
  return o;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// OTHER GENERATED FILES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function genVuserInit(){ return 'vuser_init()\n{\n\treturn 0;\n}\n'; }
function genVuserEnd() { return 'vuser_end()\n{\n\treturn 0;\n}\n'; }
function genGlobalsH(){
  return `#ifndef _GLOBALS_H\n#define _GLOBALS_H\n\n`+
    `//--------------------------------------------------------------------\n`+
    `// Include Files\n`+
    `#include "lrun.h"\n`+
    `#include "web_api.h"\n`+
    `#include "lrw_custom_body.h"\n\n`+
    `//--------------------------------------------------------------------\n`+
    `// Global Variables\n\n`+
    `#endif // _GLOBALS_H\n`;
}

function buildScripts(){
  const isWeb = S.format==='webhttp' || S.format==='both';
  const isDev = S.format==='devweb'  || S.format==='both';
  S.scripts={};
  if(isWeb){ S.scripts.ac=genActionC(); S.scripts.vi=genVuserInit(); S.scripts.ve=genVuserEnd(); S.scripts.gh=genGlobalsH(); }
  if(isDev){ S.scripts.mj=genMainJS(); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCRIPT PREVIEW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchTab(el,tab){
  document.querySelectorAll('.code-tab').forEach(t=>t.classList.remove('act'));
  el.classList.add('act');
  S.tab=tab; showScript();
}
function showScript(){
  document.getElementById('code-body').textContent =
    S.scripts[S.tab]||'// No content â€” load a HAR file first';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DOWNLOAD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function dl(key){
  const c=S.scripts[key];
  if(!c){alert('Load a HAR file first.');return;}
  const a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([c],{type:'text/plain'}));
  a.download=FILE_NAMES[key]; a.click();
}
function dlAll(){
  if(!S.scripts.ac&&!S.scripts.mj){alert('Load a HAR file first.');return;}
  const isWeb=S.format==='webhttp'||S.format==='both';
  const isDev=S.format==='devweb' ||S.format==='both';
  if(isWeb) ['ac','vi','ve','gh'].forEach(k=>dl(k));
  if(isDev) dl('mj');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SELECT MODE â€” MANUAL TRANSACTION CREATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleSelMode(){
  S.selMode=!S.selMode;
  const btn=document.getElementById('btn-sel');
  const bar=document.getElementById('sel-bar');
  if(S.selMode){
    btn.style.cssText='background:var(--primary-bg);color:var(--primary);font-weight:700';
    bar.style.display='flex';
  } else {
    btn.style.cssText=''; clearSel();
    bar.style.display='none';
  }
  renderTable();
}

function rowClick(id){
  if(!S.selMode) return;
  const e=S.entries.find(x=>x.id===id);
  if(!e||e.filtered||e.isMarker) return;
  if(S.selIds.has(id)) S.selIds.delete(id);
  else S.selIds.add(id);
  const row=document.getElementById('r'+id);
  if(row) row.classList.toggle('row-sel',S.selIds.has(id));
  document.getElementById('sel-cnt').textContent=`${S.selIds.size} selected`;
}

function clearSel(){
  S.selIds.clear();
  document.querySelectorAll('.row-sel').forEach(r=>r.classList.remove('row-sel'));
  document.getElementById('sel-cnt').textContent='0 selected';
}

function openTxnModal(){
  if(S.selIds.size===0){alert('Click rows to select them first.');return;}
  document.getElementById('modal-bg').classList.remove('hidden');
  const inp=document.getElementById('txn-inp');
  inp.value=`T${String(S.txns.length+1).padStart(2,'0')}_`;
  setTimeout(()=>inp.focus(),50);
}

function closeModal(){ document.getElementById('modal-bg').classList.add('hidden'); }

function confirmTxn(){
  const name=document.getElementById('txn-inp').value.trim();
  if(!name){alert('Enter a transaction name.');return;}
  if(!/^[a-zA-Z][a-zA-Z0-9_]*$/.test(name)){
    alert('Name must start with a letter and contain only letters, numbers, underscores.');return;
  }
  closeModal();

  // Sort selected IDs in original order
  const ids=Array.from(S.selIds).sort((a,b)=>a-b);
  const firstIdx=S.entries.findIndex(e=>e.id===ids[0]);
  const lastIdx =S.entries.findIndex(e=>e.id===ids[ids.length-1]);

  const c=COLORS[S.txns.length%COLORS.length];
  S.txns.push({name,color:c});
  S.colorMap[name]=c;

  const mk=(type)=>({id:-Date.now()-Math.random(),url:'',method:'',status:0,ct:'',
    size:0,dur:0,reqHdrs:[],hdrsMap:{},body:null,referer:'',
    isMarker:true,markerType:type,txnName:name,filtered:false,txn:null});

  // Insert END marker after last, START marker before first
  S.entries.splice(lastIdx+1, 0, mk('end'));
  S.entries.splice(firstIdx, 0, mk('start'));

  // Mark entries as belonging to this transaction
  for(const e of S.entries){ if(ids.includes(e.id)) e.txn=name; }

  S.selMode=false;
  document.getElementById('btn-sel').style.cssText='';
  document.getElementById('sel-bar').style.display='none';
  clearSel();
  buildScripts(); renderTable(); renderStats(); showScript();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DOMAIN FILTER PANEL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildDomainStats(){
  S.domainStats={};
  for(const e of S.entries){
    if(e.isMarker) continue;
    try{
      const host=new URL(e.url).hostname;
      if(!S.domainStats[host]) S.domainStats[host]={count:0,size:0};
      S.domainStats[host].count++;
      S.domainStats[host].size+=(e.size||0);
      if(S.domainFilter[host]===undefined) S.domainFilter[host]=true; // default: include
    }catch{}
  }
  // Clean up stale entries from a previous HAR
  const valid=new Set(Object.keys(S.domainStats));
  Object.keys(S.domainFilter).forEach(d=>{ if(!valid.has(d)) delete S.domainFilter[d]; });
}

function renderDomainPanel(search=''){
  const q=(search||'').trim().toLowerCase();
  // Sort: unchecked first? No â€” sort by request count desc (most requests at top, like VuGen)
  const domains=Object.keys(S.domainStats)
    .filter(d=>!q||d.includes(q))
    .sort((a,b)=>S.domainStats[b].count-S.domainStats[a].count);

  // Update header title
  const total=Object.keys(S.domainStats).length;
  const active=Object.values(S.domainFilter).filter(Boolean).length;
  document.getElementById('dp-title').textContent=
    `Domains (${active}/${total})`;

  if(!domains.length){
    document.getElementById('dp-list').innerHTML=
      `<div class="dp-empty">${q?'No match':'No domains'}</div>`;
    return;
  }

  let html='';
  for(const d of domains){
    const st=S.domainStats[d];
    const on=S.domainFilter[d]!==false;
    const dEsc=d.replace(/\\/g,'\\\\').replace(/'/g,"\\'");
    html+=`<div class="dp-row${on?'':' dm-off'}" title="${d}" onclick="onDpClick(event,'${dEsc}')">
      <input type="checkbox" ${on?'checked':''} onclick="event.stopPropagation();toggleDomain('${dEsc}',this.checked)">
      <span class="dp-domain">${d}</span>
      <span class="dp-meta">${st.count}req<br>${fmtSize(st.size)}</span>
    </div>`;
  }
  document.getElementById('dp-list').innerHTML=html;
}

// Called when user clicks the row div (not the checkbox directly)
function onDpClick(event, domain){
  const chk=event.currentTarget.querySelector('input[type=checkbox]');
  const newState=!chk.checked;
  chk.checked=newState;
  toggleDomain(domain, newState);
}

function toggleDomain(domain, state){
  S.domainFilter[domain]=state;
  const q=document.querySelector('.dp-search')?.value||'';
  renderDomainPanel(q);
  applyFilters(); buildScripts(); renderTable(); renderStats(); showScript();
}

function toggleAllDomains(state){
  Object.keys(S.domainFilter).forEach(d=>S.domainFilter[d]=state);
  renderDomainPanel(document.querySelector('.dp-search')?.value||'');
  applyFilters(); buildScripts(); renderTable(); renderStats(); showScript();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FORMAT PICKER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openFmtModal(fromToolbar){
  // Show/hide Cancel button â€” only useful when already in main panel
  document.getElementById('fmt-cancel-btn').classList.toggle('hidden', !fromToolbar);
  // Highlight current selection
  ['webhttp','devweb','both'].forEach(f=>{
    document.getElementById('fc-'+f).classList.toggle('selected', f===S.format);
  });
  document.getElementById('fmt-modal-bg').classList.remove('hidden');
}

function selectFmt(fmt){
  S.format=fmt;
  ['webhttp','devweb','both'].forEach(f=>{
    document.getElementById('fc-'+f).classList.toggle('selected', f===fmt);
  });
}

function closeFmtModal(){
  document.getElementById('fmt-modal-bg').classList.add('hidden');
}

function confirmFmt(){
  closeFmtModal();
  processHAR(S.pendingHar);
  document.getElementById('welcome').classList.add('hidden');
  document.getElementById('main').classList.remove('hidden');
  applyFmtUI();
}

function applyFmtUI(){
  const isWeb=S.format==='webhttp'||S.format==='both';
  const isDev=S.format==='devweb' ||S.format==='both';

  // Show/hide code tabs
  document.querySelector('[data-tab="ac"]').classList.toggle('hidden',!isWeb);
  document.querySelector('[data-tab="vi"]').classList.toggle('hidden',!isWeb);
  document.querySelector('[data-tab="ve"]').classList.toggle('hidden',!isWeb);
  document.querySelector('[data-tab="gh"]').classList.toggle('hidden',!isWeb);
  document.querySelector('[data-tab="mj"]').classList.toggle('hidden',!isDev);

  // Show/hide download bar sections
  document.getElementById('dl-webhttp').classList.toggle('hidden',!isWeb);
  document.getElementById('dl-devweb').classList.toggle('hidden',!isDev);
  document.getElementById('dl-sep').classList.toggle('hidden',!(isWeb&&isDev));

  // Update format badge
  const labels={webhttp:'ğŸŒ Web HTTP/HTML', devweb:'âš¡ DevWeb', both:'ğŸŒ+âš¡ Both Formats'};
  document.getElementById('fmt-badge').textContent=labels[S.format]||'';

  // Activate the best default tab
  if(isDev && !isWeb){
    const el=document.querySelector('[data-tab="mj"]');
    switchTab(el,'mj');
  } else {
    const el=document.querySelector('[data-tab="ac"]');
    switchTab(el,'ac');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showWelcome(){
  document.getElementById('welcome').classList.remove('hidden');
  document.getElementById('main').classList.add('hidden');
}
function clearAll(){
  if(S.entries.length>0 && !confirm('Clear all data?')) return;
  S.entries=[]; S.txns=[]; S.colorMap={}; S.selIds.clear(); S.scripts={}; S.pendingHar=null; S.domainFilter={}; S.domainStats={};
  document.getElementById('tbody').innerHTML='';
  document.getElementById('stats').textContent='';
  document.getElementById('code-body').textContent='// Load a HAR file to generate scripts';
  document.getElementById('hf').value='';
  document.getElementById('dp-list').innerHTML='<div class="dp-empty">Load a HAR file</div>';
  document.getElementById('dp-title').textContent='Domains';
  showWelcome();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UTILITIES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function esc(s){ return(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
function escJs(s){ return(s||'').replace(/\\/g,'\\\\').replace(/"/g,'\\"').replace(/\n/g,'\\n').replace(/\r/g,'\\r').replace(/\t/g,'\\t'); }
function escTpl(s){ return(s||'').replace(/\\/g,'\\\\').replace(/`/g,'\\`').replace(/\$\{/g,'\\${'); }
function fmtSize(b){
  if(!b||b<=0) return '-';
  if(b<1024) return b+'B';
  if(b<1048576) return(b/1024).toFixed(1)+'KB';
  return(b/1048576).toFixed(1)+'MB';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RESIZABLE PANELS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setupResizer(rsId, side){
  const rs=document.getElementById(rsId);
  if(!rs) return;
  rs.addEventListener('mousedown',function(e){
    e.preventDefault();
    // side='left'  â†’ resize the pane to the LEFT of this resizer (domain-pane)
    // side='right' â†’ resize the pane to the RIGHT of this resizer (code-pane)
    const pane = side==='left' ? rs.previousElementSibling : rs.nextElementSibling;
    const startX=e.clientX;
    const startW=pane.getBoundingClientRect().width;
    rs.classList.add('rs-active');
    document.body.style.cursor='col-resize';
    document.body.style.userSelect='none';

    function onMove(mv){
      const dx=mv.clientX-startX;
      let newW;
      if(side==='left'){
        newW=Math.max(120, Math.min(420, startW+dx));
      } else {
        // dragging right resizer left â†’ code-pane grows; right â†’ shrinks
        newW=Math.max(220, Math.min(900, startW-dx));
      }
      pane.style.width=newW+'px';
      pane.style.flex='none';
    }
    function onUp(){
      rs.classList.remove('rs-active');
      document.body.style.cursor='';
      document.body.style.userSelect='';
      document.removeEventListener('mousemove',onMove);
      document.removeEventListener('mouseup',onUp);
    }
    document.addEventListener('mousemove',onMove);
    document.addEventListener('mouseup',onUp);
  });
}
setupResizer('rs-left','left');
setupResizer('rs-right','right');

// Close modals on backdrop click
document.getElementById('modal-bg').addEventListener('click',function(e){
  if(e.target===this) closeModal();
});
document.getElementById('fmt-modal-bg').addEventListener('click',function(e){
  if(e.target===this && !document.getElementById('fmt-cancel-btn').classList.contains('hidden')) closeFmtModal();
});
</script>
</body>
</html>
